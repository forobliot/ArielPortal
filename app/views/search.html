<div class="panel panel-info">

	<div class="panel-body bg-info">
		
		<h1 class="arl-title">Offerta didattica</h1>

		<p style="float: left; padding-right: 10px;"><kbd>Numero siti</kbd> <strong>{{ result.ProjectCount }}</strong></p>
		<p style="float: left; padding-right: 10px;" ng-bind-html="searchVerbose" ng-show="searchVerbose"></p>
		<p style="float: left; padding-right: 10px;" ng-bind-html="searchFilterVerbose" ng-show="searchFilterVerbose"></p>
		<p style="float: right; padding-left: 10px;" ng-hide="isSearchForm">
			<button class="btn btn-primary btn-xs" ng-click="isSearchForm = true">
				<span class="glyphicon glyphicon-search"></span> 
				Apri ricerca avanzata
			</button>
			<button class="btn btn-primary btn-xs" ng-click="resetSearch()"><span class="glyphicon glyphicon-remove"></span> Elimina filtro</button>
		</p>
		<p style="float: right; padding-left: 10px;" ng-show="isSearchForm">
			<button class="btn btn-danger btn-xs" ng-click="isSearchForm = false">
				<span class="glyphicon glyphicon-search"></span> 
				Chiudi ricerca avanzata
			</button>
		</p>

		<!-- form ricerca avanzata -->
		<form class="arl-separated" style="clear: both;" role="form" ng-show="isSearchForm">
			<h3>Ricerca avanzata</h3>
			<div class="form-group">
				<label for="faculty">Facoltà</label>
				<select id="faculty" class="form-control" ng-options="key as faculty.Description for (key, faculty) in faculties" ng-change="fillCdses()" ng-model="searchContext.FacultyKey">
					<option value="">-- selziona una facoltà --</option>
					
				</select>
			</div>
			<div ng-show="cdses.length">
				<label for="cds">Corsi di Studio</label>
				<select id="cds" class="form-control" ng-options="cds.Key as cds.PrettyName for cds in cdses" ng-model="searchContext.CdsKey">
					<option value="">-- Tutti i corsi di studio --</option>
				</select>
			</div>
			<div class="row">
				<div class="col-md-6 form-group">
					<label for="keyword">Parola chiave</label>
					<input type="text" id="keyword" class="form-control" ng-model="searchContext.Keyword">
				</div>
				<div class="col-md-6 form-group">
					<label for="teacher">Nome docente</label>
					<input type="text" id="teacher" class="form-control" ng-model="searchContext.Teacher">
				</div>
			</div>
			<div class="form-group" ng-show="user">
				<strong style="padding-right: 10px;">Filtri</strong>
				<label class="checkbox-inline" ng-show="user.IsBaseStudent">
					<input type="checkbox" ng-model="searchContext.SearchFlags.IsCDSRuleComplying">
					CdS compatibili
				</label>
				<label class="checkbox-inline" ng-show="user.IsBaseStudent">
					<input type="checkbox" ng-model="searchContext.SearchFlags.IsW4Visible">
					W4 compatibili
				</label>
				<label class="checkbox-inline">
					<input type="checkbox" ng-model="searchContext.SearchFlags.IsEnrolled">
					Visitati
				</label>
				<label class="checkbox-inline">
					<input type="checkbox" ng-model="searchContext.SearchFlags.IsFavorite">
					Preferiti
				</label>
				<label class="checkbox-inline" ng-show="user.IsBaseStudent">
					<input type="checkbox" ng-model="searchContext.SearchFlags.IsInfaculty">
					Della facoltà
				</label>
				<label class="checkbox-inline" ng-show="user.IsOwner">
					<input type="checkbox" ng-model="searchContext.SearchFlags.IsOwner">
					Titolare
				</label>
				<label class="checkbox-inline">
					<input type="checkbox" ng-model="searchContext.SearchFlags.IsRuleComplying">
					Accessibili
				</label>
			</div>
			<div class="form-group">
				<button class="btn btn-default" ng-click="search()">Cerca</button>
				<button class="btn btn-default" ng-click="reset()">Reset</button>
			</div>
		</form>
	</div>

</div>
<p ng-show="isBack"><a href="" ng-click="back()"><span class="glyphicon glyphicon-arrow-left"></span> Torna all'elenco precedente</a></p>

<div ng-repeat="header in result.SearchHeaderList">
	
	<!-- intestazione di facoltà -->
	<div ng-if="header.Faculty" ng-class="'arl-level' + header.Level">
		<h3><small><span class="arl-dot glyphicon glyphicon-asterisk" ng-class="'arl-faculty-' + header.Faculty.Key"></span></small> <a href="" ng-click="search(header.Faculty.Key)">{{ header.Faculty.Description }}</a> <small>({{ header.Faculty.ProjectCount }} siti)</small></h3>
	</div>

	<!-- intestazione testuale -->
	<div ng-if="!header.Faculty" ng-class="'arl-level' + header.Level">
		<h3>{{ header.Title }}</h3>
		<p ng-show="header.Note">{{ header.Note }}</p>
	</div>
	
	<!-- Elenco progetti -->
	<ul class="list-group" ng-show="header.ProjectList">
		<li  class="list-group-item" ng-repeat="pw in header.ProjectList | limitTo: showCount">

			<h4>
				<small><span style="height: 19px;" class="text-danger arl-square">M</span></small>
				<small><span ng-show="pw.Project.IsPoolMaster" class="glyphicon glyphicon-fullscreen text-danger arl-square"></span></small>
				<small><span ng-repeat="f in pw.Project.FacultyList" ><span class="glyphicon glyphicon-asterisk arl-dot" ng-class="'arl-faculty-'+f.Key" title="{{ f.Description }}"></span> </span></small>
				<span ng-bind-html="pw.Project.Name" />
			</h4>

			<div>
				<small>
					<strong>
						{{pw.Project.ProjectTypeString == "Default" || pw.Project.ProjectTypeString == "Other" ? 'Docent' : 'Coordinator'}}{{pw.Project.OwnerList.length == 1 ? "e" : "i"}}:
					</strong>
					<ul class="arl-teacher-list">
						<li ng-repeat="teacher in pw.Project.OwnerList">{{ teacher.FirstName }} {{ teacher.LastName }}</li>
					</ul>
				</small>
			</div>

			<div ng-hide="pw.Project.IsPublic"><small class="text-danger bg-danger"><strong>Sito non pubblico</strong></small></div>
			<div ng-hide="pw.IsRuleComplying"><small class="text-danger bg-danger"><strong>Sito non accessibile</strong></small></div>
			<div ng-show="pw.LastAccessDate"><small>Ultima visita: {{ pw.LastAccessDate | date : 'd/MM/yyyy HH:mm' }}</small> </div>
			<ul ng-show="isdebug">
				<li ng-repeat="attr in projectAttrs">
					{{ projectAttrs[$index] }}: <span ng-class="pw[attr] ? 'bg-success' : 'bg-danger'">{{ pw[attr] }}</span>
				</li>
			</ul>
			<div class="text-right">
				<button 
					ng-show="user && pw.IsRuleComplying" 
					type="button" 
					class="btn btn-xs" 
					ng-class="pw.IsFavorite ? 'btn-danger' : 'btn-default'"
					ng-click="toggleFavorite(pw)"
					ng-bind-html="pw.IsFavorite ? '<span class=\'glyphicon glyphicon-asterisk\'></span> Rimuovi dai preferiti' : '<span class=\'glyphicon glyphicon-plus-sign\'></span> Aggiungi ai preferiti'">
				</button> 
				<button ng-show="pw.Project.IsPoolMaster" type="button" class="btn btn-primary btn-xs" ng-click="getPool(pw)">Siti correlati</button>
				<button ng-click="getProject(pw)" type="button" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-info-sign"></span> <span ng-show="pw.Project.Id == projectCardId">Chiudi</span> Info</button>
			</div>

			<div class="arl-siteinfo arl-separator" ng-if="pw.Project.Id == projectCardId" ng-include="'views/card.html'"></div>
		</li>
	</ul>

	<p ng-show="header.ProjectList.length > showCount"><a href="" ng-click="showMore()">Visualizza altri siti... (mancano all'elenco {{ header.ProjectList.length - showCount }} siti)</a></p>

</div>

<p ng-show="result.ProjectCount == 0">
	<em>Nessun sito trovato</em>
</p>



